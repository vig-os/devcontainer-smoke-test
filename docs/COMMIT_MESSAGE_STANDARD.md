# Commit Message Standard

This document defines the commit message format used in this repository. Commit messages are treated as **quality records** and must follow this standard to ensure consistency, traceability, and compliance with QMS expectations (e.g. IEC 62304, ISO 13485, MDR change control).

## Format

```text
type(scope)!: short description

Body

Refs: <IDs>
```

- **First line:** `type(scope)!: short description`
  - `type` — One of the approved commit types (see below).
  - `(scope)` — Optional. Scope in parentheses (e.g. `(ci)`, `(docs)`). Alphanumeric and hyphens only.
  - `!` — Optional. Indicates a breaking change.
  - `short description` — Brief, imperative summary. No period at the end.
- **Blank line** — Required after the subject.
- **Body** — Optional. Include additional context on _what_ and _why_. May have multiple paragraphs. If present, end the body with a blank line before the Refs line.
- **Refs line** — Mandatory for most types. Exactly one line starting with `Refs:`; it must be the last non-empty line. Include at least one GitHub issue ID (e.g. `#36`); other references (e.g. `REQ-...`, `RISK-...`, `SOP-...`) may follow. See [Exemptions](#exemptions) for types where `Refs:` is optional.

## Enforcing the template in VS Code / Cursor

- **Git commit template** — A `.gitmessage` file in the repo root is used as the default message when you run `git commit` from the terminal (no `-m`). After `just init` or devcontainer setup, `commit.template` is set to `.gitmessage` so the template is loaded when Git opens the editor.
- **Source Control + AI** — When using the Source Control panel and the GitHub extension to generate the message:
  1. Type `committemplate` in the message box and choose the **Commit message template** snippet to insert the structure, then edit or paste the AI suggestion into the first line and `Refs:` line; or
  2. Run `git commit` from the terminal (no `-m`) so Git opens the editor with the template, then paste or adapt the AI-generated message there.
- **Validation** — The commit-msg hook (and CI) will reject any commit that does not match this standard, so the template and snippet only help you start from the right format; the hook enforces it.

## Approved commit types

Only the following types are allowed:

| Type       | Use for |
|------------|---------|
| `feat`     | New functionality, enhancements |
| `fix`      | Bug fixes |
| `docs`     | Documentation only |
| `chore`    | Maintenance, tooling, config (no code/docs behavior change) |
| `refactor` | Code refactoring, no new behavior |
| `test`     | Tests, test infrastructure |
| `ci`       | CI/CD, workflows, automation |
| `build`    | Commits that affect build components like build scripts and makefiles |
| `revert`   | Reverting a previous commit |
| `style`    | Formatting, whitespace (no code change) |

Any other type (e.g. `feature`, `bugfix`, or emoji-based prefixes) is **not** allowed.

## Refs line and traceability

The `Refs:` line provides mandatory traceability to issues, requirements, risks, or SOPs. Only one `Refs:` line is allowed; it must be the last non-empty line of the message.

**Accepted reference formats:**

- **Issue numbers:** `#36`, (GitHub issue ID).
- **Requirements:** `REQ-123`, `REQ-SYS-001` (alphanumeric and hyphens after `REQ-`).
- **Risks:** `RISK-45`, `RISK-H-02` (alphanumeric and hyphens after `RISK-`).
- **SOPs:** `SOP-001`, `SOP-DEV-02` (alphanumeric and hyphens after `SOP-`).

**Examples of valid Refs lines:**

```text
Refs: #36
Refs: #36, #37
Refs: #36, REQ-123
Refs: #36, RISK-H-02, SOP-DEV-02
```

At least one reference to a GitHub issue must be present (e.g. `#36`).
Multiple references are comma-separated; spaces after commas are optional. Do not add a second `Refs:` line.

## Exemptions

The following commit types have a relaxed `Refs:` requirement:

- **`chore`** — The `Refs:` line is **optional**. Maintenance commits (e.g. dependency bumps, sync operations, tooling updates) may not relate to a specific issue. When a related issue or PR exists, including `Refs:` is still recommended.

Additionally:

- **Dependabot commits** — Automated dependency update commits generated by Dependabot (e.g. `ci(deps): bump actions/checkout`) are exempt from the `Refs:` requirement. These commits are created by an external bot that cannot add a `Refs:` line. When squash-merging Dependabot PRs, the merge commit should follow the standard format if possible.

The commit-msg hook and CI validator enforce these exemptions automatically.

## Compliance note

This standard supports:

- **IEC 62304** — Software configuration and change management (traceability of changes).
- **ISO 13485** — Documented procedures and records (this document is the procedure; commit messages are records).
- **MDR / FDA** — Change control and audit trail expectations.

Enforcement is performed locally (commit-msg hook) and in CI so that only compliant messages are accepted.
Existing history is not modified; the standard applies only to new commits.
